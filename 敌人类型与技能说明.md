# 敌人类型与技能详细说明

## 目录
1. [基础敌人类型](#基础敌人类型)
2. [精英敌人](#精英敌人)
3. [Boss敌人](#boss敌人)
4. [层数属性增长](#层数属性增长)
5. [各层数敌人属性详细数据](#各层数敌人属性详细数据)

---

## 基础敌人类型

### 1. 步兵 (Infantry)
- **出现层数**: 第1层
- **基础属性** (第1层):
  - 生命值: 25 HP
  - 体型: 18
  - 移动速度: 0.7
  - 颜色: `#ff4444` (红色)
- **技能**: 
  - ❌ 无特殊技能
  - ✅ 接触伤害：造成接触伤害并应用ICD（内部冷却）
- **特性**: 基础近战单位，直接冲向玩家

---

### 2. 快速虫 (Bug)
- **出现层数**: 第3层
- **基础属性** (第1层):
  - 生命值: 2.5 HP (baseHealth × 0.1)
  - 体型: 12.6 (baseSize × 0.7)
  - 移动速度: 2.0 (实际移动速度 × 2 = 4.0)
  - 颜色: `#44ff44` (绿色)
- **技能**: 
  - ❌ 无特殊技能
  - ✅ 接触伤害：造成接触伤害，ICD为500ms（更快的攻击频率）
  - ✅ 超高速度：移动速度是普通敌人的2倍
- **特性**: 快速、脆皮，数量多，用速度逼迫玩家走位

---

### 3. 弓箭手 (Archer)
- **出现层数**: 第5层
- **基础属性** (第1层):
  - 生命值: 20 HP (baseHealth × 0.8)
  - 体型: 16.2 (baseSize × 0.9)
  - 移动速度: 0.8
  - 颜色: `#4444ff` (蓝色)
- **技能**: 
  - ✅ **远程射击**: 
    - 冷却时间: 3000ms (3秒，随层数减少)
    - 攻击距离: 300像素
    - 伤害: 15 + 层数 × 2
    - 有1秒预警线，然后发射直线弹道（追踪当前玩家位置）
    - 投射物速度: 10像素/帧
    - 投射物生命周期: 6秒（360帧）
    - 保持250像素距离，避免近身
  - ❌ 无接触伤害（保持距离）
- **特性**: 远程单位，保持距离攻击玩家

---

### 4. 狙击手 (Sniper)
- **出现层数**: 第4层（高威胁单位，较早出现）
- **基础属性** (第1层):
  - 生命值: 25 HP (baseHealth × 1.0)
  - 体型: 18 (baseSize × 1.0)
  - 移动速度: 0.6
  - 颜色: `#ff4444` (红色，表示高威胁)
- **技能**: 
  - ✅ **高伤害远程射击**: 
    - 冷却时间: 1500ms (1.5秒，更快，随层数减少)
    - 攻击距离: 350像素
    - 伤害: 20 + 层数 × 3（比普通弓箭手更高）
    - 有1秒预警线，然后发射直线弹道（追踪当前玩家位置）
    - 投射物速度: 10像素/帧
    - 投射物生命周期: 6秒（360帧）
    - 保持250像素距离
  - ❌ 无接触伤害
- **特性**: 高伤害远程单位，需要优先处理

---

### 5. 护盾守卫 (Shieldguard)
- **出现层数**: 第7层
- **基础属性** (第1层):
  - 生命值: 62.5 HP (baseHealth × 2.5)
  - 体型: 28.8 (baseSize × 1.6)
  - 移动速度: 0.4 (实际 × 0.4 = 0.16，极慢)
  - 颜色: `#888888` (灰色)
  - 护盾值: 50 + 层数 × 10
  - 最大护盾: 50 + 层数 × 10
- **技能**: 
  - ✅ **护盾保护**: 
    - 拥有护盾，可以吸收伤害
    - 护盾被击破后，5秒后重生
    - 护盾存在时击退玩家更强（8像素 vs 5像素）
  - ✅ **接触伤害**: 造成接触伤害并击退玩家
  - 击退距离: 护盾存在时8像素，无护盾时5像素
- **特性**: 高血量、慢速、防御型单位，有护盾机制

---

### 6. 爆破蝠 (Bomb Bat)
- **出现层数**: 第9层
- **基础属性** (第1层):
  - 生命值: 15 HP (baseHealth × 0.6)
  - 体型: 14.4 (baseSize × 0.8)
  - 移动速度: 1.2 (实际 × 1.2 = 1.44)
  - 颜色: `#884488` (紫色)
- **技能**: 
  - ✅ **主动自爆**: 
    - 当距离玩家 < 50像素时自动爆炸
    - 爆炸半径: 100像素
    - 爆炸伤害: 20 + 层数 × 2
    - 主动自爆给予玩家额外15分
  - ✅ 接触伤害（在自爆前）
- **特性**: 快速接近玩家后自爆，范围伤害威胁大

---

### 7. 治疗师 (Healer)
- **出现层数**: 第11层
- **基础属性** (第1层):
  - 生命值: 30 HP (baseHealth × 1.2)
  - 体型: 18 (baseSize × 1.0)
  - 移动速度: 0.6 (实际 × 0.6 = 0.36)
  - 颜色: `#00ff88` (青色)
- **技能**: 
  - ✅ **治疗光环**: 
    - 冷却时间: 3000ms (攻击冷却)/ 5000ms (技能冷却)
    - 治疗范围: 150像素
    - 每次治疗量: 3 HP
    - 持续治疗周围受伤的友军
  - ❌ 无接触伤害（无攻击性）
- **特性**: 支援单位，治疗附近敌人，需要优先击杀

---

### 8. 投弹手 (Grenadier)
- **出现层数**: 第13层
- **基础属性** (第1层):
  - 生命值: 45 HP (baseHealth × 1.8)
  - 体型: 19.8 (baseSize × 1.1)
  - 移动速度: 0.5 (实际 × 0.5 = 0.25)
  - 颜色: `#ff8800` (橙色)
- **技能**: 
  - ✅ **抛物线投弹**: 
    - 冷却时间: 4000ms (4秒)
    - 攻击距离: < 400像素
    - 伤害: 15 + 层数 × 2
    - 投射物为抛物线轨迹，落地爆炸
    - 投射物有重力效果
  - ❌ 无接触伤害
- **特性**: 远程抛物攻击，需要预判落点躲避

---

### 9. 召唤师 (Summoner)
- **出现层数**: 第15层
- **基础属性** (第1层):
  - 生命值: 50 HP (baseHealth × 2.0)
  - 体型: 21.6 (baseSize × 1.2)
  - 移动速度: 0.5 (实际 × 0.5 = 0.25)
  - 颜色: `#ff00ff` (紫色)
- **技能**: 
  - ✅ **召唤小怪**: 
    - 冷却时间: 8000ms (8秒)
    - 召唤数量: 2只快速虫
    - 召唤距离: 敌人周围60-100像素
    - 召唤的快速虫属性: 5 HP, 体型12, 速度2.0
  - ❌ 无接触伤害
- **特性**: 持续召唤小怪增加压力，需要快速击杀

---

### 10. 幻影刺客 (Phantom)
- **出现层数**: 第17层
- **基础属性** (第1层):
  - 生命值: 22.5 HP (baseHealth × 0.9)
  - 体型: 12.6 (baseSize × 0.7)
  - 移动速度: 1.8 (实际 × 1.8 = 3.24)
  - 颜色: `#9900ff` (深紫色)
- **技能**: 
  - ❌ 无特殊技能（当前实现）
  - ✅ 接触伤害
- **特性**: 高速单位，快速接近玩家造成伤害

---

## 精英敌人

### 1. 重装队长 (Shield Captain) - 第8层
- **生命值**: 100 HP (baseHealth × 4)
- **体型**: 32.4 (baseSize × 1.8)
- **移动速度**: 0.5
- **颜色**: `#555555` (深灰色)
- **技能冷却**: 8000ms
- **特性**: 高血量精英，拥有护盾

---

### 2. 精英治疗师 (Elite Healer) - 第14层
- **生命值**: 75 HP (baseHealth × 3)
- **体型**: 27 (baseSize × 1.5)
- **移动速度**: 0.6
- **颜色**: `#00ff88` (青色)
- **技能冷却**: 4000ms
- **特性**: 更强的治疗能力

---

### 3. 虚空刺客 (Void Assassin) - 第18层
- **生命值**: 50 HP (baseHealth × 2)
- **体型**: 18 (baseSize × 1.0)
- **移动速度**: 1.5
- **颜色**: `#9900ff` (深紫色)
- **技能冷却**: 3000ms
- **特性**: 高速刺客，闪现攻击

---

## Boss敌人

### 1. Boss (通用Boss类型)
- **出现条件**: 特殊时间生成
- **基础属性** (第1层):
  - 生命值: 125 HP (baseHealth × 5.0)
  - 体型: 36 (baseSize × 2.0)
  - 移动速度: 0.6
  - 颜色: `#ff6600` (橙红色)
  - 护盾值: 100 + 层数 × 20
  - 最大护盾: 100 + 层数 × 20

- **技能**: 
  - ✅ **多阶段战斗**:
    - 阶段1 (< 60% HP): 基础阶段
    - 阶段2 (30-60% HP): 激活阶段，速度 × 1.2
    - 阶段3 (< 30% HP): 狂暴阶段，速度 × 1.5
  - ✅ **远程多弹幕攻击**: 
    - 冷却时间: 2000ms (随层数减少)
    - 攻击弹数: 等于当前阶段数（1/2/3发）
    - 每发伤害: 25 + 层数 × 3
    - 发射角度: 扇形分布（±0.3弧度）
    - 投射物速度: 10像素/帧
    - 投射物追踪当前玩家位置
  - ✅ **护盾重生**: 
    - 护盾被击破后，3秒后重生（比普通护盾兵更快）
  - ✅ **召唤小怪** (阶段2+): 
    - 冷却时间: 6000ms
    - 召唤2只快速虫
  - ✅ **范围爆炸** (阶段3): 
    - 冷却时间: 6000ms
    - 爆炸半径: 120像素
    - 爆炸伤害: 30 + 层数 × 4
  - ✅ **接触伤害**: 基础伤害 × 1.6倍

---

## 层数属性增长

### 基础属性计算公式

#### 生命值增长
```
基础生命值 = 25
生命倍数 = 1 + (层数 - 1) × 0.15
最终生命值 = 基础生命值 × 生命倍数 × 敌人类型倍数
```

#### 体型增长
```
基础体型 = 18
最终体型 = 基础体型 + 层数 × 0.5
最终体型 = 最终体型 × 敌人类型倍数
```

#### 接触伤害增长
```
基础伤害 = 6 + (层数 - 1) × (层数 < 11 ? 0.7 : 1.0)
最终伤害 = 基础伤害 × 敌人类型伤害倍数
```

#### 敌人类型伤害倍数
- `infantry`: 1.0
- `bug`: 0.2 (伤害大幅削减)
- `runner`: 1.05
- `archer`: 0.7 (远程单位接触伤害低)
- `shooter`: 0.9
- `shieldguard`: 1.1
- `bomb_bat`: 0.8
- `brute`: 1.25
- `boss`: 1.6

#### 接触伤害ICD (内部冷却)
- `grunt`: 750ms
- `bug`: 500ms (更快)
- `runner`: 600ms
- `shooter`: 800ms
- `shield`: 800ms
- `shielded`: 800ms
- `brute`: 900ms
- `exploder`: 0ms (只有爆炸伤害)

---

## 各层数敌人属性详细数据

### 第1层
| 敌人类型 | 生命值 | 体型 | 移速 | 接触伤害 | 特殊能力 |
|---------|--------|------|------|----------|----------|
| 步兵 | 25 | 18 | 0.7 | 6.0 | 无 |

### 第5层
| 敌人类型 | 生命值 | 体型 | 移速 | 接触伤害 | 特殊能力 |
|---------|--------|------|------|----------|----------|
| 步兵 | 55 | 20.5 | 0.7 | 9.4 | 无 |
| 快速虫 | 5.5 | 14.35 | 4.0 | 1.9 | 高速移动 |
| 弓箭手 | 44 | 18.45 | 0.8 | 6.6 | 远程射击(17伤害) |
| 狙击手 | 55 | 20.5 | 0.6 | 9.4 | 远程射击(35伤害) |

### 第10层
| 敌人类型 | 生命值 | 体型 | 移速 | 接触伤害 | 特殊能力 |
|---------|--------|------|------|----------|----------|
| 步兵 | 137.5 | 23 | 0.7 | 12.6 | 无 |
| 快速虫 | 13.75 | 16.1 | 4.0 | 2.5 | 高速移动 |
| 弓箭手 | 110 | 20.7 | 0.8 | 8.8 | 远程射击(35伤害) |
| 狙击手 | 137.5 | 23 | 0.6 | 12.6 | 远程射击(50伤害) |
| 护盾守卫 | 343.75 | 36.8 | 0.16 | 13.9 | 护盾(150) |
| 爆破蝠 | 82.5 | 18.4 | 1.44 | 10.1 | 自爆(40伤害) |

### 第15层
| 敌人类型 | 生命值 | 体型 | 移速 | 接触伤害 | 特殊能力 |
|---------|--------|------|------|----------|----------|
| 步兵 | 212.5 | 25.5 | 0.7 | 16.6 | 无 |
| 快速虫 | 21.25 | 17.85 | 4.0 | 3.3 | 高速移动 |
| 弓箭手 | 170 | 22.95 | 0.8 | 11.6 | 远程射击(45伤害) |
| 狙击手 | 212.5 | 25.5 | 0.6 | 16.6 | 远程射击(65伤害) |
| 护盾守卫 | 531.25 | 40.8 | 0.16 | 18.3 | 护盾(200) |
| 爆破蝠 | 127.5 | 20.4 | 1.44 | 13.3 | 自爆(45伤害) |
| 治疗师 | 255 | 25.5 | 0.36 | 0 | 治疗光环(3 HP) |
| 投弹手 | 382.5 | 28.05 | 0.25 | 0 | 抛物线投弹(45伤害) |
| 召唤师 | 425 | 30.6 | 0.25 | 0 | 召唤小怪 |

### 第20层
| 敌人类型 | 生命值 | 体型 | 移速 | 接触伤害 | 特殊能力 |
|---------|--------|------|------|----------|----------|
| 步兵 | 287.5 | 28 | 0.7 | 26.0 | 无 |
| 快速虫 | 28.75 | 19.6 | 4.0 | 5.2 | 高速移动 |
| 弓箭手 | 230 | 25.2 | 0.8 | 18.2 | 远程射击(55伤害) |
| 狙击手 | 287.5 | 28 | 0.6 | 26.0 | 远程射击(80伤害) |
| 护盾守卫 | 718.75 | 44.8 | 0.16 | 28.6 | 护盾(250) |
| 爆破蝠 | 172.5 | 22.4 | 1.44 | 20.8 | 自爆(60伤害) |
| 治疗师 | 345 | 28 | 0.36 | 0 | 治疗光环(3 HP) |
| 投弹手 | 517.5 | 30.8 | 0.25 | 0 | 抛物线投弹(55伤害) |
| 召唤师 | 575 | 33.6 | 0.25 | 0 | 召唤小怪 |
| 幻影刺客 | 258.75 | 19.6 | 3.24 | 23.4 | 高速接近 |

---

## 注意事项

1. **属性增长机制** (已完善):
   - ✅ **生命值**: 随层数线性增长（每层 +15%）
     - 公式: `baseHealth × (1 + (layer - 1) × 0.15) × 敌人类型倍数`
   - ✅ **体型**: 随层数线性增长（每层 +0.5）
     - 公式: `(18 + layer × 0.5) × 敌人类型倍数`
   - ✅ **移速**: 随层数线性增长（第1层为基准，第20层增加35%）
     - 公式: `baseSpeed × (1.0 + (layer - 1) × 0.35 / 19)`
     - 例子: 步兵第1层0.7，第20层约0.94
   - ✅ **接触伤害**: 随层数增长（前10层每层+0.7，11层后每层+1.0）
     - 公式: `6 + (layer - 1) × (layer < 11 ? 0.7 : 1.0) × 敌人类型倍数`
   - ✅ **远程攻击伤害**: 随层数增长（不同敌人增长幅度不同）
     - 弓箭手: `15 + layer × 2`
     - 狙击手: `20 + layer × 3`
     - 投弹手: `15 + layer × 2`
     - Boss: `25 + layer × 3`
   - ✅ **攻击/技能冷却**: 随层数减少（第1层为基准，第20层减少25%，攻击更快）
     - 公式: `baseCooldown × max(0.75, 1.0 - (layer - 1) × 0.25 / 19)`
     - 最少减少到原来的50%
   - ✅ **护盾值**: 随层数增长
     - 护盾守卫: `50 + layer × 10`
     - Boss: `100 + layer × 20`

2. **属性增长示例对比**:

| 属性 | 第1层 | 第10层 | 第20层 | 增长幅度 |
|-----|-------|--------|--------|----------|
| 步兵生命值 | 25 | 137.5 | 287.5 | +1050% |
| 步兵移速 | 0.7 | 0.83 | 0.94 | +34% |
| 弓箭手攻击冷却 | 3000ms | 2750ms | 2250ms | -25% |
| 接触伤害 | 6.0 | 12.6 | 26.0 | +333% |

3. **游戏平衡说明**:
   - 随着层数增加，敌人变得更强大：
     - 生命值大幅增长（需要更多攻击）
     - 移速适度增长（逼迫更快的反应）
     - 攻击冷却减少（威胁频率增加）
     - 伤害增长（容错率降低）
   - 这个设计确保游戏难度曲线平滑且具有挑战性

4. **远程攻击伤害修复说明** (已修复):
   - ✅ **修复前问题**: 
     - 敌人投射物使用1秒前预测的玩家位置，导致射偏
     - 碰撞半径太小（20像素），难以击中
     - 投射物速度单位不一致
     - 投射物生命周期太短
   - ✅ **修复后改进**:
     - 投射物现在使用发射时的**最新玩家位置**，提高命中率
     - 碰撞半径从20像素增加到25像素，更容易击中
     - 投射物速度统一为10像素/帧（与玩家投射物速度12类似）
     - 投射物生命周期增加到6秒（360帧）
     - 添加了调试日志，帮助诊断伤害应用问题
     - Boss投射物也使用相同速度和追踪机制
   - ⚠️ **注意事项**:
     - 投射物仍有1秒预警延迟，但会在延迟后使用最新玩家位置
     - 如果玩家处于无敌帧或触发伤害堆叠上限，投射物不会造成伤害（会有日志提示）
     - 碰撞检测每帧执行，确保及时响应

