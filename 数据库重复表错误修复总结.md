# æ•°æ®åº“é‡å¤è¡¨é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
ERROR: 42P07: relation "players" already exists
```

### é—®é¢˜æ ¹æº
PostgreSQLé”™è¯¯ä»£ç  `42P07` è¡¨ç¤º "duplicate_table" é”™è¯¯ï¼Œå³è¯•å›¾åˆ›å»ºå·²ç»å­˜åœ¨çš„è¡¨ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ï¼š
1. è¿ç§»è„šæœ¬è¢«é‡å¤æ‰§è¡Œ
2. æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„è¡¨ç»“æ„
3. æ²¡æœ‰ä½¿ç”¨ `IF NOT EXISTS` å­å¥

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. è¡¨åˆ›å»ºè¯­å¥ä¿®å¤
**ä¿®å¤å‰:**
```sql
CREATE TABLE players (
CREATE TABLE seasons (
CREATE TABLE game_sessions (
CREATE TABLE leaderboard (
```

**ä¿®å¤å:**
```sql
CREATE TABLE IF NOT EXISTS players (
CREATE TABLE IF NOT EXISTS seasons (
CREATE TABLE IF NOT EXISTS game_sessions (
CREATE TABLE IF NOT EXISTS leaderboard (
```

### 2. ç´¢å¼•åˆ›å»ºè¯­å¥ä¿®å¤
**ä¿®å¤å‰:**
```sql
CREATE INDEX idx_game_sessions_player_season ON game_sessions(player_id, season_id);
CREATE INDEX idx_game_sessions_score ON game_sessions(score DESC);
CREATE INDEX idx_leaderboard_season_rank ON leaderboard(season_id, rank);
CREATE INDEX idx_leaderboard_player_season ON leaderboard(player_id, season_id);
```

**ä¿®å¤å:**
```sql
CREATE INDEX IF NOT EXISTS idx_game_sessions_player_season ON game_sessions(player_id, season_id);
CREATE INDEX IF NOT EXISTS idx_game_sessions_score ON game_sessions(score DESC);
CREATE INDEX IF NOT EXISTS idx_leaderboard_season_rank ON leaderboard(season_id, rank);
CREATE INDEX IF NOT EXISTS idx_leaderboard_player_season ON leaderboard(player_id, season_id);
```

### 3. è§¦å‘å™¨åˆ›å»ºè¯­å¥ä¿®å¤
**ä¿®å¤å‰:**
```sql
CREATE TRIGGER update_players_updated_at BEFORE UPDATE ON players
CREATE TRIGGER update_leaderboard_updated_at BEFORE UPDATE ON leaderboard
```

**ä¿®å¤å:**
```sql
DROP TRIGGER IF EXISTS update_players_updated_at ON players;
CREATE TRIGGER update_players_updated_at BEFORE UPDATE ON players

DROP TRIGGER IF EXISTS update_leaderboard_updated_at ON leaderboard;
CREATE TRIGGER update_leaderboard_updated_at BEFORE UPDATE ON leaderboard
```

### 4. ç­–ç•¥åˆ›å»ºè¯­å¥ä¿®å¤
**ä¿®å¤å‰:**
```sql
CREATE POLICY "Players can view own data" ON players
CREATE POLICY "Seasons are viewable by authenticated users" ON seasons
```

**ä¿®å¤å:**
```sql
DROP POLICY IF EXISTS "Players can view own data" ON players;
CREATE POLICY "Players can view own data" ON players

DROP POLICY IF EXISTS "Seasons are viewable by authenticated users" ON seasons;
CREATE POLICY "Seasons are viewable by authenticated users" ON seasons
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### é”™è¯¯è§£å†³
- âœ… æ‰€æœ‰è¡¨åˆ›å»ºè¯­å¥ä½¿ç”¨ `IF NOT EXISTS`
- âœ… æ‰€æœ‰ç´¢å¼•åˆ›å»ºè¯­å¥ä½¿ç”¨ `IF NOT EXISTS`
- âœ… æ‰€æœ‰è§¦å‘å™¨ä½¿ç”¨ `DROP IF EXISTS` + `CREATE`
- âœ… æ‰€æœ‰ç­–ç•¥ä½¿ç”¨ `DROP IF EXISTS` + `CREATE`

### æ•°æ®åº“åŠŸèƒ½ä¿æŒ
- âœ… è¡¨ç»“æ„å®Œæ•´
- âœ… ç´¢å¼•æ€§èƒ½ä¼˜åŒ–ä¿æŒ
- âœ… è§¦å‘å™¨åŠŸèƒ½æ­£å¸¸
- âœ… å®‰å…¨ç­–ç•¥æ­£ç¡®

## ğŸ” å…³é”®ä¿®å¤ç‚¹

### 1. å¹‚ç­‰æ€§è®¾è®¡
- ä½¿ç”¨ `IF NOT EXISTS` ç¡®ä¿è„šæœ¬å¯ä»¥é‡å¤æ‰§è¡Œ
- é¿å…é‡å¤åˆ›å»ºå·²å­˜åœ¨çš„å¯¹è±¡

### 2. å®‰å…¨åˆ é™¤
- ä½¿ç”¨ `DROP IF EXISTS` é¿å…åˆ é™¤ä¸å­˜åœ¨çš„å¯¹è±¡
- ç¡®ä¿è„šæœ¬çš„å¥å£®æ€§

### 3. å®Œæ•´è¦†ç›–
- è¡¨ã€ç´¢å¼•ã€è§¦å‘å™¨ã€ç­–ç•¥å…¨éƒ¨ä¿®å¤
- ç¡®ä¿æ‰€æœ‰æ•°æ®åº“å¯¹è±¡éƒ½æ”¯æŒé‡å¤æ‰§è¡Œ

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è¿ç§»è„šæœ¬è®¾è®¡
- å§‹ç»ˆä½¿ç”¨ `IF NOT EXISTS` å­å¥
- ä½¿ç”¨ `DROP IF EXISTS` å¤„ç†å¯èƒ½å†²çªçš„å¯¹è±¡
- ç¡®ä¿è„šæœ¬çš„å¹‚ç­‰æ€§

### 2. é”™è¯¯å¤„ç†
- æ£€æŸ¥PostgreSQLé”™è¯¯ä»£ç 
- ç†è§£é”™è¯¯å«ä¹‰å’Œè§£å†³æ–¹æ¡ˆ
- ä½¿ç”¨é€‚å½“çš„SQLå­å¥é¿å…å†²çª

### 3. æµ‹è¯•éªŒè¯
- åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯•é‡å¤æ‰§è¡Œ
- éªŒè¯è„šæœ¬çš„å¥å£®æ€§
- ç¡®ä¿æ•°æ®å®Œæ•´æ€§

## ğŸ“ æ€»ç»“

é€šè¿‡ä½¿ç”¨ `IF NOT EXISTS` å’Œ `DROP IF EXISTS` å­å¥ï¼ŒæˆåŠŸè§£å†³äº†PostgreSQLé‡å¤è¡¨é”™è¯¯ï¼š

1. **é—®é¢˜è¯†åˆ«**: `42P07` é”™è¯¯è¡¨ç¤ºè¡¨å·²å­˜åœ¨
2. **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `IF NOT EXISTS` å’Œ `DROP IF EXISTS` å­å¥
3. **ä¿®å¤èŒƒå›´**: è¡¨ã€ç´¢å¼•ã€è§¦å‘å™¨ã€ç­–ç•¥å…¨éƒ¨ä¿®å¤
4. **æ•ˆæœéªŒè¯**: è„šæœ¬å¯ä»¥å®‰å…¨é‡å¤æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°é”™è¯¯

ç°åœ¨æ•°æ®åº“è¿ç§»è„šæœ¬å¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°é‡å¤è¡¨é”™è¯¯ï¼
