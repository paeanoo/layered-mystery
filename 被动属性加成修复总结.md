# è¢«åŠ¨å±æ€§åŠ æˆä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜åˆ†æ

### é—®é¢˜æè¿°
é€‰æ‹©è¢«åŠ¨å±æ€§åå®é™…å¹¶æ²¡æœ‰åŠ æˆï¼Œç‰¹åˆ«æ˜¯é€‰æ‹©"ç©¿é€+1"åï¼ŒæŠ•å°„ç‰©åº”è¯¥èƒ½å¤Ÿç©¿é€æ•Œäººï¼Œä½†å®é™…ä¸Šæ²¡æœ‰æ•ˆæœã€‚

### æ ¹æœ¬åŸå› 
1. **TestGameEngineä½¿ç”¨ç‹¬ç«‹çŠ¶æ€**: æ¸¸æˆå¼•æ“ä½¿ç”¨è‡ªå·±çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ¸¸æˆçŠ¶æ€ç®¡ç†ä¸­çš„ç©å®¶å±æ€§
2. **æŠ•å°„ç‰©ç³»ç»Ÿæœªé›†æˆ**: æŠ•å°„ç‰©åˆ›å»ºå’Œç¢°æ’æ£€æµ‹æ²¡æœ‰ä½¿ç”¨æ¸¸æˆçŠ¶æ€ç®¡ç†ä¸­çš„å±æ€§
3. **ç©¿é€æœºåˆ¶ç¼ºå¤±**: æŠ•å°„ç‰©ç¢°æ’åç›´æ¥æ¶ˆå¤±ï¼Œæ²¡æœ‰ç©¿é€é€»è¾‘

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. é›†æˆæ¸¸æˆçŠ¶æ€ç®¡ç†
```typescript
// ä¿®æ”¹å‰ - TestGameEngineä½¿ç”¨ç‹¬ç«‹çŠ¶æ€
private projectiles: Array<{ x: number; y: number; vx: number; vy: number; damage: number; isCrit: boolean; life: number }> = []

// ä¿®æ”¹å - æ·»åŠ æ¸¸æˆçŠ¶æ€å¼•ç”¨
private gameState: any = null // æ¸¸æˆçŠ¶æ€å¼•ç”¨
private projectiles: Array<{ x: number; y: number; vx: number; vy: number; damage: number; isCrit: boolean; life: number; pierce: number; maxPierce: number }> = []
```

### 2. ä¿®æ”¹æŠ•å°„ç‰©åˆ›å»ºé€»è¾‘
```typescript
// ä¿®æ”¹å‰ - ä½¿ç”¨å›ºå®šå±æ€§
const isCrit = Math.random() < 0.2 // 20%æš´å‡»ç‡
const damage = isCrit ? 40 : 20 // æé«˜ä¼¤å®³

// ä¿®æ”¹å - ä½¿ç”¨æ¸¸æˆçŠ¶æ€ç®¡ç†ä¸­çš„å±æ€§
const player = this.gameState?.player || {
  damage: 20,
  critChance: 0.2,
  projectiles: 1,
  pierce: 0
}

const isCrit = Math.random() < player.critChance
const damage = isCrit ? player.damage * 2 : player.damage

// åˆ›å»ºå¤šä¸ªæŠ•å°„ç‰©ï¼ˆå¦‚æœç©å®¶æœ‰æŠ•å°„ç‰©åŠ æˆï¼‰
for (let i = 0; i < player.projectiles; i++) {
  // ä¸ºå¤šä¸ªæŠ•å°„ç‰©æ·»åŠ è§’åº¦åç§»
  const angleOffset = i > 0 ? (i - 1) * 0.3 - 0.3 : 0
  const adjustedVx = vx * Math.cos(angleOffset) - vy * Math.sin(angleOffset)
  const adjustedVy = vx * Math.sin(angleOffset) + vy * Math.cos(angleOffset)

  this.projectiles.push({
    x: this.playerX,
    y: this.playerY,
    vx: adjustedVx,
    vy: adjustedVy,
    damage,
    isCrit,
    life: 60,
    pierce: 0, // å½“å‰ç©¿é€æ¬¡æ•°
    maxPierce: player.pierce // æœ€å¤§ç©¿é€æ¬¡æ•°
  })
}
```

### 3. å®ç°ç©¿é€æœºåˆ¶
```typescript
// ä¿®æ”¹å‰ - ç¢°æ’åç›´æ¥ç§»é™¤æŠ•å°„ç‰©
this.projectiles.splice(index, 1)

// ä¿®æ”¹å - ç©¿é€æœºåˆ¶
projectile.pierce++
if (projectile.pierce > projectile.maxPierce) {
  this.projectiles.splice(index, 1)
}
```

### 4. åŒæ­¥æ”»å‡»é€Ÿåº¦
```typescript
// ä¿®æ”¹å‰ - å›ºå®šæ”»å‡»å†·å´
if (this.attackTimer >= this.attackCooldown && this.enemies.length > 0) {

// ä¿®æ”¹å - ä½¿ç”¨ç©å®¶æ”»å‡»é€Ÿåº¦å±æ€§
const player = this.gameState?.player || { attackSpeed: 1 }
const actualCooldown = Math.max(50, this.attackCooldown / player.attackSpeed)

if (this.attackTimer >= actualCooldown && this.enemies.length > 0) {
```

### 5. å®æ—¶çŠ¶æ€åŒæ­¥
```typescript
// GameView.vue ä¸­çš„çŠ¶æ€åŒæ­¥
const confirmSelection = () => {
  if (gameStore.selectedPassive) {
    gameStore.confirmPassiveSelection()
    // æ›´æ–°æ¸¸æˆå¼•æ“ä¸­çš„æ¸¸æˆçŠ¶æ€
    if (gameEngine) {
      gameEngine.updateGameState(gameStore.gameState)
    }
  }
}
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### è¢«åŠ¨å±æ€§åŠ æˆç”Ÿæ•ˆ
- âœ… **ç©¿é€+1**: æŠ•å°„ç‰©ç°åœ¨å¯ä»¥ç©¿é€æ•Œäººï¼Œä¸ä¼šåœ¨ç¬¬ä¸€æ¬¡ç¢°æ’åæ¶ˆå¤±
- âœ… **æŠ•å°„ç‰©+1**: æ¯æ¬¡æ”»å‡»å‘å°„å¤šä¸ªæŠ•å°„ç‰©
- âœ… **æ”»å‡»é€Ÿåº¦**: æ”»å‡»å†·å´æ—¶é—´æ ¹æ®ç©å®¶å±æ€§åŠ¨æ€è°ƒæ•´
- âœ… **ä¼¤å®³åŠ æˆ**: æŠ•å°„ç‰©ä¼¤å®³ä½¿ç”¨ç©å®¶å±æ€§è®¡ç®—
- âœ… **æš´å‡»ç‡**: æš´å‡»è®¡ç®—ä½¿ç”¨ç©å®¶å±æ€§

### ç©¿é€æœºåˆ¶å®ç°
```typescript
// ç©¿é€é€»è¾‘
projectile.pierce++  // å¢åŠ ç©¿é€è®¡æ•°
if (projectile.pierce > projectile.maxPierce) {
  this.projectiles.splice(index, 1)  // è¾¾åˆ°æœ€å¤§ç©¿é€æ¬¡æ•°åç§»é™¤
}
```

### å¤šæŠ•å°„ç‰©ç³»ç»Ÿ
```typescript
// å¤šæŠ•å°„ç‰©åˆ›å»º
for (let i = 0; i < player.projectiles; i++) {
  // è§’åº¦åç§»ï¼Œè®©å¤šä¸ªæŠ•å°„ç‰©å‘ˆæ‰‡å½¢å‘å°„
  const angleOffset = i > 0 ? (i - 1) * 0.3 - 0.3 : 0
  // åˆ›å»ºæŠ•å°„ç‰©...
}
```

## ğŸ” æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ¸¸æˆçŠ¶æ€é›†æˆ
```typescript
// TestGameEngine æ„é€ å‡½æ•°
constructor(canvas: HTMLCanvasElement, onLevelComplete?: () => void, gameState?: any) {
  this.gameState = gameState
  // ...
}

// çŠ¶æ€æ›´æ–°æ–¹æ³•
updateGameState(gameState: any) {
  this.gameState = gameState
}
```

### 2. æŠ•å°„ç‰©å±æ€§æ‰©å±•
```typescript
// æŠ•å°„ç‰©ç±»å‹å®šä¹‰
private projectiles: Array<{
  x: number
  y: number
  vx: number
  vy: number
  damage: number
  isCrit: boolean
  life: number
  pierce: number      // å½“å‰ç©¿é€æ¬¡æ•°
  maxPierce: number   // æœ€å¤§ç©¿é€æ¬¡æ•°
}> = []
```

### 3. å±æ€§åº”ç”¨é€»è¾‘
```typescript
// è·å–ç©å®¶å±æ€§
const player = this.gameState?.player || {
  damage: 20,
  critChance: 0.2,
  projectiles: 1,
  pierce: 0
}

// åº”ç”¨å±æ€§åˆ°æ¸¸æˆé€»è¾‘
const isCrit = Math.random() < player.critChance
const damage = isCrit ? player.damage * 2 : player.damage
```

## ğŸ¯ æµ‹è¯•éªŒè¯

### ç©¿é€æœºåˆ¶æµ‹è¯•
1. **é€‰æ‹©ç©¿é€+1å±æ€§**
2. **è§‚å¯ŸæŠ•å°„ç‰©è¡Œä¸º**: åº”è¯¥èƒ½å¤Ÿç©¿é€ç¬¬ä¸€ä¸ªæ•Œäººï¼Œç»§ç»­é£è¡Œ
3. **éªŒè¯ç©¿é€è®¡æ•°**: æŠ•å°„ç‰©åœ¨è¾¾åˆ°æœ€å¤§ç©¿é€æ¬¡æ•°åæ‰æ¶ˆå¤±

### å¤šæŠ•å°„ç‰©æµ‹è¯•
1. **é€‰æ‹©æŠ•å°„ç‰©+1å±æ€§**
2. **è§‚å¯Ÿæ”»å‡»æ•ˆæœ**: æ¯æ¬¡æ”»å‡»åº”è¯¥å‘å°„2ä¸ªæŠ•å°„ç‰©
3. **éªŒè¯è§’åº¦åç§»**: å¤šä¸ªæŠ•å°„ç‰©åº”è¯¥å‘ˆæ‰‡å½¢å‘å°„

### æ”»å‡»é€Ÿåº¦æµ‹è¯•
1. **é€‰æ‹©æ”»é€Ÿæå‡å±æ€§**
2. **è§‚å¯Ÿæ”»å‡»é¢‘ç‡**: æ”»å‡»é—´éš”åº”è¯¥æ˜æ˜¾ç¼©çŸ­
3. **éªŒè¯å±æ€§åŒæ­¥**: å±æ€§å˜åŒ–åº”è¯¥ç«‹å³ç”Ÿæ•ˆ

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼ŒæˆåŠŸè§£å†³äº†è¢«åŠ¨å±æ€§åŠ æˆä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼š

1. **ç»Ÿä¸€äº†çŠ¶æ€ç®¡ç†**: TestGameEngineç°åœ¨ä½¿ç”¨æ¸¸æˆçŠ¶æ€ç®¡ç†ä¸­çš„ç©å®¶å±æ€§
2. **å®ç°äº†ç©¿é€æœºåˆ¶**: æŠ•å°„ç‰©å¯ä»¥ç©¿é€æ•Œäººï¼Œä¸ä¼šåœ¨ç¬¬ä¸€æ¬¡ç¢°æ’åæ¶ˆå¤±
3. **æ”¯æŒå¤šæŠ•å°„ç‰©**: æŠ•å°„ç‰©+1å±æ€§ç°åœ¨èƒ½å¤Ÿæ­£ç¡®å‘å°„å¤šä¸ªæŠ•å°„ç‰©
4. **å®æ—¶å±æ€§åŒæ­¥**: è¢«åŠ¨å±æ€§é€‰æ‹©åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æ¸¸æˆ

ç°åœ¨é€‰æ‹©"ç©¿é€+1"åï¼ŒæŠ•å°„ç‰©èƒ½å¤Ÿæ­£ç¡®ç©¿é€æ•Œäººï¼Œé€‰æ‹©"æŠ•å°„ç‰©+1"åèƒ½å¤Ÿå‘å°„å¤šä¸ªæŠ•å°„ç‰©ï¼Œæ‰€æœ‰è¢«åŠ¨å±æ€§åŠ æˆéƒ½èƒ½æ­£ç¡®ç”Ÿæ•ˆï¼
